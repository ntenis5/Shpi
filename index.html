<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paneli i Pronave</title>
  <style>
    body {
      margin: 0;
      background: #121212;
      font-family: Arial, sans-serif;
      color: white;
      overflow-x: hidden;
    }

    #globeContainer {
      width: 80vw;
      height: 80vw;
      max-width: 400px;
      max-height: 400px;
      margin: 40px auto 20px;
      border-radius: 50%;
      overflow: hidden;
      box-shadow: 0 0 15px orange;
      cursor: pointer;
    }

    #orbitContainer {
      position: relative;
      width: 100%;
      max-width: 400px;
      height: 400px;
      margin: auto;
    }

    .orbit-button {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: orange;
      color: black;
      font-weight: bold;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 8px #ffb347;
      transition: transform 0.2s ease;
    }

    .orbit-button:hover {
      transform: scale(1.1);
    }

    #searchPanel {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);
      z-index: 1000;
      width: 320px;
    }

    #searchPanel input,
    #searchPanel button {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      box-sizing: border-box;
    }

    #searchPanel button {
      background: orange;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }

    #searchPanel button:hover {
      background: #ffb347;
    }
  </style>
</head>
<body>

  <div id="orbitContainer">
    <button class="orbit-button" onclick="filterByCategory('Apartament')">Apartament</button>
    <button class="orbit-button" onclick="filterByCategory('Shtëpi')">Shtëpi</button>
    <button class="orbit-button" onclick="filterByCategory('Tokë')">Tokë</button>
    <button class="orbit-button" onclick="filterByCategory('Biznes')">Biznes</button>
  </div>

  <div id="globeContainer" title="Kliko për të zgjedhur lokacionin">
    <div id="globeViz"></div>
  </div>

  <div id="searchPanel">
    <h3>Zgjidh Lokacionin</h3>
    <input id="stateInput" placeholder="Shteti" />
    <input id="cityInput" placeholder="Qyteti" />
    <button onclick="goToMap()">Kërko Pronat</button>
  </div>

  <!-- Script-at e nevojshme -->
  <script src="https://unpkg.com/three"></script>
  <script src="https://cdn.jsdelivr.net/npm/three-globe@2.24.8"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAzeg2ha8agdS5zKFB34Udwj2CTMJamy0E",
      authDomain: "shpi-d4e2d.firebaseapp.com",
      projectId: "shpi-d4e2d",
      storageBucket: "shpi-d4e2d.appspot.com",
      messagingSenderId: "600471884377",
      appId: "1:600471884377:web:5512544dc9dfb1fa009748"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const globe = new ThreeGlobe()
      .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-night.jpg')
      .pointAltitude(0.05)
      .pointColor(() => 'orange')
      .pointLabel(d => `${d.category}<br>${d.city}<br>€${d.price}`);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true });
    renderer.setSize(300, 300);
    document.getElementById('globeViz').appendChild(renderer.domElement);

    camera.position.z = 2;
    scene.add(globe);

    function animate() {
      requestAnimationFrame(animate);
      globe.rotation.y += 0.002;
      renderer.render(scene, camera);
    }

    animate();

    let allProperties = [];

    async function loadProperties() {
      const snapshot = await db.collection("properties").get();
      allProperties = snapshot.docs.map(doc => doc.data());
      globe.pointsData(allProperties);
    }

    loadProperties();

    function filterByCategory(cat) {
      const filtered = allProperties.filter(p => p.category.toLowerCase() === cat.toLowerCase());
      globe.pointsData(filtered);
    }

    document.getElementById('globeContainer').addEventListener('click', () => {
      document.getElementById('searchPanel').style.display = 'block';
    });

    function goToMap() {
      const city = document.getElementById('cityInput').value.trim();
      const state = document.getElementById('stateInput').value.trim();
      if (!city || !state) return alert('Plotësoni qytetin dhe shtetin.');
      window.location.href = `map.html?city=${encodeURIComponent(city)}&state=${encodeURIComponent(state)}`;
    }

    // Orbit butonat
    const orbitButtons = document.querySelectorAll('.orbit-button');
    const centerX = 160, centerY = 160, radius = 120;
    orbitButtons.forEach((btn, i) => {
      const angle = (i / orbitButtons.length) * 2 * Math.PI;
      btn.style.left = `${centerX + radius * Math.cos(angle) - 40}px`;
      btn.style.top = `${centerY + radius * Math.sin(angle) - 40}px`;
    });
  </script>

</body>
</html>
